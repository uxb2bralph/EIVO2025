@using System.IO
@using System.Linq.Expressions


@using ModelCore.Helper


@using WebHome.Helper
@using WebHome.Models
@using WebHome.Controllers
@using ModelCore.DataEntity
@using ModelCore.Locale
@using ModelCore.Security.MembershipManagement
@using ModelCore.Models.ViewModel
@using CommonLib.Core.Utility
@using CommonLib.Utility
@using Microsoft.AspNetCore.Mvc.ModelBinding
@using Microsoft.AspNetCore.Mvc.Razor

@using Newtonsoft.Json

@{
    ModelStateDictionary _modelState;
    ModelSource<InvoiceItem> models;

    models = (ModelSource<InvoiceItem>)ViewContext.HttpContext.Items["Models"]!;
    UserProfile _profile = Context.GetUser();
    _modelState = (ModelStateDictionary)ViewBag.ModelState;

    InquireInvoiceViewModel _viewModel = (InquireInvoiceViewModel)ViewBag.ViewModel;
    _viewModel.UrlAction = Url.Action("InquireInvoice", "InvoiceAudit");

}
<!-- 發票資料 -->
<!-- 交易畫面標題 -->
<div class="py-2 eivo__title d-flex align-items-center justify-content-between">
    @{
        await Html.RenderPartialAsync("~/Views/SiteAction/FunctionTitleBar.cshtml", "發票資料");
    }
</div>
@{
    ViewBag.DisplayType = Naming.FieldDisplayType.Query;
}

<!-- 查詢框 -->
<div id="searchArea" class="mb-4 card shadow-sm border-2 rounded-3">
    <div class="card-body">
        <!-- 查詢條件 -->
        <div class="px-2 row row-cols-1 row-cols-md-1 row-cols-lg-2 row-cols-xl-3 row-cols-xxl-3">
            <div class="py-2 col">
                <div class="row">
                    <label for="invoice" class="col-md-4 col-form-label fw-bold text-nowrap">
                        查詢項目
                    </label>
                    <div class="col pt-1 d-flex align-items-center">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="invoice" name="DocType"
                                value="@((int)Naming.DocumentTypeDefinition.E_Invoice)" @(_viewModel.DocType ==
                                                                                                                        Naming.DocumentTypeDefinition.E_Invoice ? "checked" : null)
                                onchange="window.location.href='@Html.Raw(Url.Action("QueryIndex", "InvoiceAudit"))';" />
                            <label class="form-check-label text-nowrap" for="invoice">
                                發票
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="allowance" name="DocType"
                                value="@((int)Naming.DocumentTypeDefinition.E_Invoice)" @(_viewModel.DocType ==
                                                                                                                        Naming.DocumentTypeDefinition.E_Allowance ? "checked" : null)
                                onchange="window.location.href='@Html.Raw(Url.Action("AllowanceIndex", "InvoiceAudit"))';" />
                            <label class="form-check-label text-nowrap" for="allowance">
                                折讓單
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            @{
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/ProcessType.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/BuyerReceiptNo.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/CustomerName.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/CustomerID.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/InvoiceDate.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/InvoiceNo.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/WinningInvoice.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/Cancellation.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/PrintMark.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/CarrierType.cshtml");
                await Html.RenderPartialAsync("~/Views/InvoiceAudit/DataField/CarrierNo.cshtml");
            }
        </div>
        <!--按鈕-->
        <div class="mt-3 px-1 d-block text-end">
            <button id="btnQuery" type="button" class="px-3 my-1 me-1 btn btn-sm eivo__btn--default"
                onclick="$inquiryAgent.initQuery = true; $inquiryAgent.inquire();">
                查詢
            </button>
        </div>
    </div>
</div>
<!-- 顯示列表 -->
<div id="resultList"></div>

@if (_viewModel.StartQuery == true)
{
    <script>
        $(function () {
            $('input[name="btnQuery"]').click();
        });
    </script>
}
